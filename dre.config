singularity {
	enabled = true
	autoMounts = true
}

docker {
	enabled = false
}


params {

	// Directories

	mudata = null
	mae_object = null
	rna_df_path = null
	r_config = null
	references = null
	temp_file = null
	output = null
	container_dir = null
	
   
}


/*
Define the Singularity container file paths relative to the given container_dir parameter
*/
rstudio_mae = "file:///" + "${params.container_dir}" + "mae_multiomics_v05.sif"
mofa_mae = "file:///" + "${params.container_dir}" + "mofa-mae-v6.sif"
r_epic = "file:///" + "${params.container_dir}"+ "r-epic.sif"
muon_snf = "file:///" + "${params.container_dir}"+ "muon-snf_v0.4.sif"

process {

	withName:CELLTYPE_LEVELS {
		container = "$rstudio_mae"
	}
	withName:RIBOSOMAL_RNA_RANKS {
		container = "$rstudio_mae"
	}
	withName:SINGLE_FEATURES {
		container = "$rstudio_mae"
	}
	withName:RUN_PCA {
		container = "$rstudio_mae"
	}
	withName:COMPARE_PROTEOMICS {
		container = "$rstudio_mae"
	}
	withName:COMPARE_LIPIDOMICS {
		container = "$rstudio_mae"
	}
	withName:SAMPLES_PER_OMICS {
		container = "$rstudio_mae"
	}
	withName:RUN_MOFA {
		container = "$mofa_mae"
	}
	withName:RUN_CV {
		container = "$rstudio_mae"
	}
	withName:LINEAR_MODELS  {
		container = "$rstudio_mae"
	}
	withName:RUN_PLS2  {
		container = "$rstudio_mae"
	}
	withName:OMICS_COMBINATIONS	{
		container = "$muon_snf"
	}
	withName:SNF  {
		container = "$muon_snf"
	}
	withName:PLOT_SIL_SCORES  {
		container = "$muon_snf"
	}
	withName:SNF_ANALYSIS  {
		container = "$muon_snf"
	}

	
	/* 
	Max resources of the computational environment should be specified here:
	*/
	withLabel: full_resources {
		cpus = 2
		memory = 3.8.GB
	}
}

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.output}/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.output}/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.output}/execution_trace_${trace_timestamp}.txt"
	fields = 'task_id,name,process,status,exit,realtime,%cpu,cpus,container,rss'
}
dag {
    enabled = true
    file    = "${params.output}/pipeline_dag_${trace_timestamp}.html"
}
